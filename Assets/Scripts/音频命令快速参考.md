# 音频命令快速参考

## 命令总览

| 命令 | 功能 | 示例 |
|------|------|------|
| `MUSIC(文件名)` | 播放背景音乐（循环） | `MUSIC(bgm_battle)` |
| `SOUND(文件名)` | 播放音效（一次） | `SOUND(sfx_click)` |
| `SOUND(文件名,1)` | 循环播放音效 | `SOUND(ambient_rain,1)` |
| `SOUND(文件名,0)` | 停止循环音效 | `SOUND(ambient_rain,0)` |

## 详细说明

### MUSIC - 背景音乐

**语法：** `MUSIC(文件名)`

**特点：**
- ✓ 同时只能播放一个BGM
- ✓ 自动循环播放
- ✓ 播放新音乐会停止旧音乐
- ✓ 受BGM音量控制

**示例：**
```
MUSIC(bgm_menu)        # 播放菜单音乐
MUSIC(bgm_battle)      # 切换到战斗音乐（自动停止菜单音乐）
```

---

### SOUND - 音效（一次性）

**语法：** `SOUND(文件名)`

**特点：**
- ✓ 可以同时播放多个音效
- ✓ 播放一次后自动停止
- ✓ 受SE音量控制

**示例：**
```
SOUND(sfx_click)       # 播放点击音效
SOUND(sfx_explosion)   # 播放爆炸音效（可以与点击音效同时播放）
```

---

### SOUND - 音效（循环）

**语法：** `SOUND(文件名,1)`

**特点：**
- ✓ 持续循环播放，直到被停止
- ✓ 可以同时循环播放多个音效
- ✓ 同名音效会先停止旧的再播放新的
- ✓ 受SE音量控制

**示例：**
```
SOUND(ambient_rain,1)     # 开始循环播放雨声
SOUND(ambient_thunder,1)  # 开始循环播放雷声（与雨声同时播放）
```

---

### SOUND - 智能停止/播放

**语法：** `SOUND(文件名,0)`

**特点：**
- ✓ 如果音效正在循环播放：停止循环，让它自然播放完当前这一次
- ✓ 如果音效未在循环播放：播放一次该音效
- ✓ 提供平滑的音效过渡效果

**示例：**
```
SOUND(ambient_rain,1)     # 开始循环播放雨声
SOUND(ambient_rain,0)     # 雨声停止循环，但会自然播放完（不会突然中断）
```

**使用场景：**
```
# 场景1：平滑停止环境音
SOUND(forest_ambient,1)   # 森林环境音开始循环
旁白:你在森林中探索
SOUND(forest_ambient,0)   # 环境音平滑结束（不会突然中断）

# 场景2：确保音效播放
SOUND(door,0)             # 如果门声在循环就停止循环，否则播放一次门声
```

---

## 组合使用

可以使用 `+` 符号组合多个命令：

```
CG(scene1)+MUSIC(bgm_menu)+SOUND(ambient_wind,1)
```

这会同时执行：
1. 切换背景图到scene1
2. 播放菜单音乐
3. 开始循环播放风声

---

## 常用场景模板

### 进入战斗
```
CG(battle_bg)+MUSIC(bgm_battle)+SOUND(battle_ambient,1)
```

### 离开战斗
```
CG(normal_bg)+MUSIC(bgm_normal)+SOUND(battle_ambient,0)
```

### 下雨场景
```
SOUND(rain,1)
旁白:天空开始下雨了
角色:雨越下越大了
SOUND(rain,0)
旁白:雨渐渐停了（雨声会自然结束，不会突然中断）
```

### 森林场景
```
CG(forest)+SOUND(birds,1)+SOUND(wind,1)
旁白:你进入了一片茂密的森林
角色:这里的鸟叫声真好听
SOUND(birds,0)+SOUND(wind,0)
旁白:你离开了森林（环境音会平滑结束）
```

### 氛围转换
```
# 从平静到紧张
SOUND(calm_ambient,0)+SOUND(tense_ambient,1)

# 从紧张到平静
SOUND(tense_ambient,0)+SOUND(calm_ambient,1)
```

---

## 注意事项

1. **文件名不含扩展名**
   - ✓ 正确：`MUSIC(bgm_battle)`
   - ✗ 错误：`MUSIC(bgm_battle.wav)`

2. **文件必须在SOUND文件夹**
   - 路径：`Assets/StreamingAssets/SOUND/`
   - 支持格式：.wav, .mp3, .ogg

3. **参数说明**
   - 无第二参数 = 播放一次
   - 第二参数=1 = 循环播放
   - 第二参数=0 = 智能处理（停止循环但播放完，或播放一次）

4. **SOUND(音效,0)的智能行为**
   - 如果音效正在循环：停止循环，但让当前这一次自然播放完（平滑过渡）
   - 如果音效未在循环：播放一次该音效
   - 这样设计可以避免音效突然中断，提供更好的听觉体验

5. **性能建议**
   - 避免同时循环播放太多音效（建议不超过5个）
   - 离开场景时记得用 `SOUND(音效名,0)` 平滑停止循环音效

---

## 调试技巧

查看Unity Console日志：
- "开始播放BGM: xxx" - 音乐播放成功
- "播放音效: xxx" - 音效播放成功
- "循环播放音效: xxx" - 循环音效开始
- "停止循环音效(将自然结束): xxx" - 循环音效停止循环，但会播放完
- "立即停止循环音效: xxx" - 循环音效被立即停止（代码调用）
- "找不到音频文件: xxx" - 文件不存在

---

## 快速测试

在剧本中添加以下内容进行测试：

```
!DONTSPAWN+MUSIC(test_bgm)
旁白:音乐开始播放
!DONTSPAWN+SOUND(test_se)
旁白:播放了一个音效
!DONTSPAWN+SOUND(test_loop,1)
旁白:开始循环播放环境音
!DONTSPAWN+SOUND(test_loop,0)
旁白:停止循环音效
```

