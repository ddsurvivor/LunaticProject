# 新增特效功能总结

## 🎉 功能概览

本次更新为剧本系统添加了两个重要的视觉特效功能：

1. **CG淡入淡出效果** - 让场景切换更加平滑自然
2. **画面震动效果** - 增强戏剧性和沉浸感

---

## ✨ 新增功能

### 1. CG淡入淡出

**功能：** 切换CG时支持多种淡入淡出效果

**命令格式：**
```
CG(图片名)                    # 默认淡出后淡入
CG(图片名, 类型)              # 指定效果类型
CG(图片名, 类型, 时长)        # 完整自定义
```

**效果类型：**
- `0` - 无效果，直接切换
- `1` - 仅淡入
- `2` - 仅淡出
- `3` - 淡出后淡入（默认）

**示例：**
```
CG(forest)                    # 使用默认淡出淡入效果
CG(battle,3,1.5)              # 淡出淡入，总共1.5秒
CG(quick_scene,0)             # 立即切换，无动画
```

---

### 2. 画面震动

**功能：** 让整个剧本界面产生震动效果

**命令格式：**
```
SHAKE()                       # 默认参数
SHAKE(强度)                   # 自定义强度
SHAKE(强度, 时长)             # 自定义强度和时长
SHAKE(强度, 时长, 次数)       # 完整自定义
```

**参数说明：**
- 强度：震动幅度（像素），默认20
- 时长：持续时间（秒），默认0.5
- 次数：震动次数，默认10

**示例：**
```
SHAKE()                       # 默认震动
SHAKE(30)                     # 强度30的震动
SHAKE(40,1.0)                 # 强度40，持续1秒
SHAKE(50,0.8,15)              # 强度50，0.8秒，震15次
```

---

## 🔧 技术实现

### 代码修改

#### 1. Center.cs
```csharp
// 新增震动命令常量
public static string Command_Shake="SHAKE";
```

#### 2. 剧本System.cs

**新增字段：**
```csharp
[Header("特效设置")]
public float CG淡入淡出时间 = 0.5f;
public RectTransform 震动目标;
```

**新增方法：**
- `LoadImageWithFade()` - 加载图片带淡入淡出效果
- `执行震动()` - 执行震动效果

**修改方法：**
- `进行指令()` - 添加了对CG参数和SHAKE命令的处理

**使用的技术：**
- DOTween.DOFade() - 实现淡入淡出
- DOTween.DOShakePosition() - 实现震动

---

## 📦 文件清单

### 修改的文件
- ✅ `Assets/Scripts/Center.cs`
- ✅ `Assets/Scripts/剧本/剧本System.cs`

### 新增的文档
- ✅ `Assets/Scripts/CG特效和震动使用说明.md` - 详细使用指南
- ✅ `Assets/Scripts/特效命令快速参考.md` - 快速参考
- ✅ `Assets/Scripts/特效功能设置指南.md` - 设置指南
- ✅ `Assets/Scripts/新增特效功能总结.md` - 本文档

---

## 🎮 使用示例

### 示例1：基础场景切换
```
CG(opening_scene)
旁白:游戏开始
CG(forest,3,1.0)
旁白:你来到了森林
```

### 示例2：战斗场景
```
CG(battle_bg,3,1.0)+MUSIC(battle_theme)
旁白:战斗开始！
SOUND(sword_clash)+SHAKE(25,0.3)
旁白:刀剑相击！
```

### 示例3：爆炸效果
```
角色:小心！
SOUND(explosion)+SHAKE(50,0.6,12)+CG(explosion_effect,1,0.3)
旁白:轰！！！
```

### 示例4：地震场景
```
旁白:平静的城市
SHAKE(15,0.5)
旁白:感到轻微震动
SHAKE(35,1.5,15)
旁白:地震来了！
SOUND(rumble,1)+SHAKE(50,2.0,20)
旁白:震动越来越强烈
SOUND(rumble,0)+SHAKE(20,0.5)
旁白:渐渐平息下来
```

---

## ⚙️ 必要设置

### 在Unity Inspector中

1. **找到剧本System组件**
   - 在Hierarchy中选择剧本System所在的GameObject

2. **设置震动目标**（重要！）
   - 在Inspector的"特效设置"部分
   - 将整个剧本界面的根RectTransform拖到"震动目标"字段
   - 推荐：Canvas下的主Panel或剧本UI容器

3. **调整淡入淡出时间**（可选）
   - 默认0.5秒
   - 可根据需要调整

---

## 🎯 功能特点

### CG淡入淡出
- ✅ 4种淡入淡出模式
- ✅ 可自定义时长
- ✅ 平滑的视觉过渡
- ✅ 性能优秀（基于DOTween）
- ✅ 向后兼容（原有CG命令仍可用）

### 画面震动
- ✅ 参数完全可自定义
- ✅ 支持默认参数简化使用
- ✅ 可与其他命令组合
- ✅ 震动结束后自动归位
- ✅ 性能优秀（基于DOTween）

---

## 📝 注意事项

### CG淡入淡出
1. CG图片必须放在 `Assets/Resources/CG/` 文件夹
2. 时长建议：0.3-2.0秒
3. 避免过于频繁的切换

### 画面震动
1. **必须**在Inspector中设置震动目标
2. 震动强度建议：5-50
3. 不要过度使用震动效果
4. 同时最多1-2个震动效果

---

## 🔍 调试

### Console日志

**CG切换：**
- 无特殊日志（除非加载失败）
- 加载失败会显示："无法加载图片: xxx"

**震动效果：**
- 成功：`执行震动: 强度=30, 时长=0.5秒, 次数=10`
- 未设置目标：`震动目标未设置，请在Inspector中设置震动目标`

---

## 🚀 快速开始

### 3步快速测试

**步骤1：** 设置震动目标
- 在Inspector中设置剧本System的"震动目标"字段

**步骤2：** 准备测试图片
- 在 `Resources/CG/` 文件夹放入测试图片

**步骤3：** 添加测试命令
```
!DONTSPAWN+CG(test1)
旁白:测试淡入淡出
!DONTSPAWN+SHAKE(30)
旁白:测试震动
!DONTSPAWN+CG(test2,3,1.0)+SHAKE(25,0.5)
旁白:组合测试
```

运行游戏，进入测试剧本即可看到效果！

---

## 📊 兼容性

### 向后兼容
- ✅ 原有的 `CG(图片)` 命令仍然有效
- ✅ 现在会自动添加淡出淡入效果
- ✅ 如需无效果切换，使用 `CG(图片,0)`

### 依赖
- ✅ 依赖DOTween插件（项目中已有）
- ✅ Unity 2019.4或更高版本
- ✅ 需要UI系统（UnityEngine.UI）

---

## 🎨 推荐用法

### 常规场景切换
```
CG(new_scene,3,1.0)           # 1秒淡出淡入
```

### 快速场景切换
```
CG(quick_scene,3,0.3)         # 0.3秒快速切换
```

### 战斗冲击
```
SOUND(impact)+SHAKE(25,0.3)   # 配合音效的震动
```

### 环境变化
```
CG(thunderstorm,3,0.8)+SOUND(thunder)+SHAKE(30,0.5)
```

---

## 📚 相关文档

详细使用说明请参考：

1. **CG特效和震动使用说明.md**
   - 完整的功能说明
   - 详细的参数解释
   - 大量实战示例

2. **特效命令快速参考.md**
   - 快速查询命令格式
   - 参数速查表
   - 常用组合模板

3. **特效功能设置指南.md**
   - 详细的设置步骤
   - 常见问题排查
   - 测试方法

---

## ✅ 测试清单

完成以下测试确认功能正常：

### CG淡入淡出
- [ ] `CG(图片)` - 默认淡出淡入
- [ ] `CG(图片,0)` - 无效果
- [ ] `CG(图片,1)` - 仅淡入
- [ ] `CG(图片,2)` - 仅淡出
- [ ] `CG(图片,3)` - 淡出后淡入
- [ ] `CG(图片,3,2.0)` - 自定义时长

### 画面震动
- [ ] `SHAKE()` - 默认震动
- [ ] `SHAKE(30)` - 自定义强度
- [ ] `SHAKE(40,1.0)` - 自定义强度和时长
- [ ] `SHAKE(50,0.8,15)` - 完整自定义

### 组合效果
- [ ] CG + 震动
- [ ] CG + 音效 + 震动
- [ ] 音乐 + CG + 震动

---

## 🎉 总结

本次更新为剧本系统带来了：

✨ **更丰富的视觉效果** - 淡入淡出让场景切换更自然  
💥 **更强的表现力** - 震动效果增强戏剧性  
🎮 **更好的用户体验** - 让剧本演出更加生动  
🔧 **灵活的参数控制** - 完全自定义各种效果  
📚 **完整的文档** - 详细的使用说明和示例  

享受您的新功能吧！🎊

