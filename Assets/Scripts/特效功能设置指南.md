# 特效功能设置指南

## 🎯 快速开始

这个指南将帮助您在5分钟内设置好CG淡入淡出和画面震动功能。

---

## 📋 前置要求

✅ Unity项目中已有DOTween插件（已满足）  
✅ 剧本System已设置好  
✅ 有测试用的CG图片  

---

## 🔧 设置步骤

### 步骤1：设置震动目标

这是**最重要**的一步，否则震动效果可能不明显。

#### 1.1 找到剧本System GameObject

在Hierarchy窗口中找到包含"剧本System"组件的GameObject。

#### 1.2 确定震动目标

震动目标应该是整个剧本界面的根RectTransform。通常是以下之一：

- Canvas下的主Panel
- 剧本UI的容器GameObject
- 整个剧本显示区域的根对象

**推荐结构：**
```
Canvas
└── 剧本Panel (RectTransform) ← 这个作为震动目标
    ├── 背景Image
    ├── Content
    ├── 说话人
    └── 剧本System (脚本组件在这里)
```

#### 1.3 设置震动目标字段

1. 选中剧本System所在的GameObject
2. 在Inspector中找到"剧本System"组件
3. 找到"特效设置"部分
4. 将要震动的RectTransform拖到"震动目标"字段

![设置示意图]
```
Inspector
┌─────────────────────────────┐
│ 剧本System (Script)         │
├─────────────────────────────┤
│ ...其他字段...              │
├─────────────────────────────┤
│ ▼ 特效设置                  │
│   CG淡入淡出时间: 0.5       │
│   震动目标: [拖到这里]      │ ← 拖入RectTransform
└─────────────────────────────┘
```

### 步骤2：调整淡入淡出时间（可选）

默认值为0.5秒，您可以根据需要调整：

- **0.3秒**：快速切换
- **0.5秒**：默认，适中
- **1.0秒**：缓慢切换
- **2.0秒**：极慢，适合特殊场景

在Inspector的"CG淡入淡出时间"字段中输入您想要的值。

### 步骤3：测试功能

#### 3.1 准备测试CG

确保在 `Assets/Resources/CG/` 文件夹中有测试图片。

```
Assets
└── Resources
    └── CG
        ├── test1.png
        ├── test2.png
        └── battle.jpg
```

#### 3.2 在剧本中添加测试命令

在您的剧本Excel文件中添加测试命令：

**测试CG淡入淡出：**
```
!DONTSPAWN+CG(test1)
旁白:这是第一张图
!DONTSPAWN+CG(test2,3,1.0)
旁白:这是第二张图（淡出淡入，1秒）
```

**测试震动：**
```
!DONTSPAWN+SHAKE()
旁白:默认震动
!DONTSPAWN+SHAKE(40,0.8,12)
旁白:自定义震动
```

**测试组合效果：**
```
!DONTSPAWN+CG(battle,3,1.0)+SHAKE(30,0.5)
旁白:战斗开始！
```

#### 3.3 运行测试

1. 运行Unity游戏
2. 进入测试剧本
3. 观察效果

---

## ✅ 验证清单

完成设置后，请确认以下各项：

### CG淡入淡出
- [ ] 切换CG时能看到淡入淡出效果
- [ ] 不同类型参数有不同效果（0,1,2,3）
- [ ] 自定义时长参数生效
- [ ] Console没有错误信息

### 画面震动
- [ ] SHAKE()命令能产生震动
- [ ] 不同强度参数有明显区别
- [ ] 震动目标正确（整个界面震动，而非单个元素）
- [ ] Console显示"执行震动"日志

---

## 🐛 常见问题排查

### 问题1：震动无效果或很微弱

**原因：** 震动目标未设置或设置错误

**解决：**
1. 检查Inspector中是否设置了震动目标
2. 确保震动目标是RectTransform类型
3. 确保震动目标是整个界面容器，而非小元素
4. 查看Console是否有"震动目标未设置"警告

**验证方法：**
```
SHAKE(50,1.0,10)  # 使用大参数测试
```
如果仍然没效果，肯定是震动目标设置问题。

### 问题2：CG没有淡入淡出效果

**原因：** 可能使用了类型0或时长太短

**解决：**
1. 确认类型参数不是0
2. 确认时长不要太短（至少0.3秒）
3. 确认BG的Image组件存在
4. 检查图片是否加载成功

**验证方法：**
```
CG(test,3,2.0)  # 使用长时长测试
```

### 问题3：找不到CG图片

**错误信息：** "无法加载图片: xxx"

**解决：**
1. 确认图片在 `Assets/Resources/CG/` 文件夹
2. 文件名不要包含扩展名
3. 图片格式为Unity支持的格式（png, jpg等）

**正确路径示例：**
```
Assets/Resources/CG/forest.png  → 使用 CG(forest)
Assets/Resources/CG/battle.jpg  → 使用 CG(battle)
```

### 问题4：DOTween相关错误

**错误信息：** "DOTween not found" 或类似

**解决：**
1. 确认DOTween插件已导入
2. 检查 using DG.Tweening; 是否正确
3. 重新编译项目

### 问题5：震动后位置不归位

**原因：** DOTween震动默认会归位，如果不归位可能是其他脚本影响

**解决：**
1. 检查是否有其他脚本修改震动目标的position
2. 确认震动完成（等待duration时间）
3. 手动重置位置（如需要）

---

## ⚙️ 高级设置

### 自定义默认震动参数

如果您想修改默认震动参数，可以修改代码：

```csharp
// 在剧本System.cs中修改
public void 执行震动(float strength = 20f,    // 改这里
                     float duration = 0.5f,   // 改这里
                     int vibrato = 10)        // 改这里
```

### 自定义震动目标

如果您需要在运行时动态更改震动目标：

```csharp
剧本System.instance.震动目标 = someRectTransform;
```

### 禁用淡入淡出

如果某些CG不需要淡入淡出，使用类型0：

```
CG(quick_change,0)
```

---

## 📊 性能优化建议

### CG淡入淡出
- ✅ 避免过于频繁的CG切换
- ✅ 不要同时淡入淡出多个大图片
- ✅ 合理的时长：0.3-2.0秒

### 画面震动
- ✅ 不要连续快速调用SHAKE
- ✅ 强度控制在5-50范围内
- ✅ 同时最多1-2个震动效果
- ✅ 避免在低端设备上使用过强的震动

---

## 🎨 推荐设置

根据我们的测试，以下是推荐的参数设置：

### CG淡入淡出时间
```
快节奏剧本: 0.3秒
普通剧本:   0.5秒 (默认)
慢节奏剧本: 1.0秒
```

### 震动强度参考
```
对话音效:   5-10
动作场景:   15-25
战斗场景:   25-35
爆炸效果:   35-50
```

### 震动时长参考
```
短促冲击:   0.2-0.3秒
普通效果:   0.4-0.6秒 (默认0.5)
持续震动:   0.8-2.0秒
```

---

## 📝 测试用剧本模板

复制以下内容到您的剧本Excel进行测试：

### 基础测试
```
事件列 | 内容列
-------|-------
!DONTSPAWN+CG(test1) | 旁白:图片1（默认淡入淡出）
!DONTSPAWN+CG(test2,0) | 旁白:图片2（无效果）
!DONTSPAWN+CG(test1,1) | 旁白:图片1（仅淡入）
!DONTSPAWN+CG(test2,2) | 旁白:图片2（仅淡出）
!DONTSPAWN+CG(test1,3,2.0) | 旁白:图片1（慢速淡出淡入）
```

### 震动测试
```
事件列 | 内容列
-------|-------
!DONTSPAWN+SHAKE() | 旁白:默认震动
!DONTSPAWN+SHAKE(30) | 旁白:中等强度震动
!DONTSPAWN+SHAKE(50,1.0) | 旁白:强烈震动1秒
!DONTSPAWN+SHAKE(10,0.2,5) | 旁白:快速轻微震动
```

### 组合测试
```
事件列 | 内容列
-------|-------
!DONTSPAWN+CG(battle,3,1.0)+SHAKE(25,0.5) | 旁白:战斗场景
!DONTSPAWN+SOUND(explosion)+SHAKE(45,0.6) | 旁白:爆炸！
```

---

## 🎓 下一步

设置完成后，建议阅读：

1. **CG特效和震动使用说明.md** - 详细的使用指南
2. **特效命令快速参考.md** - 快速查询命令

---

## ✨ 享受您的新功能！

现在您已经完成了所有设置，可以开始创作更加生动的剧本了！🎉

如有任何问题，请查看本文档的"常见问题排查"部分。

