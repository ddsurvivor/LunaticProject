# 音频系统测试指南

## 快速测试步骤

### 第一步：设置AudioManager

1. 打开Unity编辑器
2. 在Hierarchy窗口中，右键点击 → Create Empty
3. 将GameObject命名为 "AudioManager"
4. 选中AudioManager，在Inspector中点击 "Add Component"
5. 搜索并添加 "AudioManager" 脚本
6. 保存场景

**可选：** 调整音量设置
- BGM音量：默认为1.0（可以在Inspector中调整）
- SE音量：默认为1.0（可以在Inspector中调整）

### 第二步：准备测试音频文件

1. 找一些测试用的音频文件（.wav或.mp3格式）
2. 将它们复制到 `Assets/StreamingAssets/SOUND/` 文件夹
3. 重命名为简单的名字，例如：
   - test_bgm.wav
   - test_sound.wav

**注意：** 如果没有音频文件，可以从网上下载一些免费的音效素材

### 第三步：在剧本中测试

在您的剧本Excel文件中，在"事件"列添加以下命令：

#### 测试音乐播放
```
MUSIC(test_bgm)
```

#### 测试音效播放（一次）
```
SOUND(test_sound)
```

#### 测试循环音效
```
SOUND(test_loop,1)
```

#### 测试停止循环音效
```
SOUND(test_loop,0)
```

#### 组合测试
```
CG(背景图)+MUSIC(test_bgm)
```

#### 完整循环音效测试
```
SOUND(ambient,1)
```
（等待几秒，让音效循环几次）
```
SOUND(ambient,0)
```
（注意：音效不会突然中断，而是会平滑地播放完当前这一次）

#### 智能播放测试
```
SOUND(test_sound,0)
```
（如果test_sound没在循环，会播放一次；如果在循环，会停止循环但播放完）

### 第四步：运行测试

1. 在Unity中运行游戏（点击Play按钮）
2. 进入有音频命令的剧本
3. 验证：
   - 音乐是否循环播放
   - 音效是否正常播放
   - 多个音效能否同时播放
   - 切换音乐时旧的音乐是否停止
   - 循环音效是否正常循环播放
   - SOUND(音效,0) 是否能平滑停止循环音效（不会突然中断）
   - SOUND(音效,0) 在没有循环时是否会播放一次

## 常见问题排查

### 问题1：没有声音
**检查：**
- [ ] AudioManager是否在场景中
- [ ] 音频文件是否在StreamingAssets/SOUND文件夹中
- [ ] 文件名是否正确（剧本中的名字要和文件名匹配，不含扩展名）
- [ ] 电脑音量是否打开
- [ ] Unity Game窗口的音量是否打开（点击Game窗口右上角的扬声器图标）

### 问题2：Console报错"找不到音频文件"
**检查：**
- [ ] 文件路径是否正确：`Assets/StreamingAssets/SOUND/文件名.扩展名`
- [ ] 文件名拼写是否正确（区分大小写）
- [ ] 文件扩展名是否为 .wav, .mp3 或 .ogg

### 问题3：AudioManager未初始化
**解决：**
- 确保场景中有AudioManager GameObject
- 确保AudioManager脚本已添加到该GameObject上
- 确保在播放音频前AudioManager已经执行了Awake

### 问题4：音乐/音效播放了但听不清
**检查：**
- [ ] AudioManager的BGM音量/SE音量是否设置太低
- [ ] 在Inspector中查看音量值（0-1之间）
- [ ] 音频文件本身的音量是否太小

## 代码测试

如果想直接在代码中测试，可以在任意脚本中添加：

```csharp
void Start()
{
    // 测试播放音乐
    if (AudioManager.instance != null)
    {
        AudioManager.instance.播放音乐("test_bgm");
    }
}

void Update()
{
    // 按空格键播放音效
    if (Input.GetKeyDown(KeyCode.Space))
    {
        if (AudioManager.instance != null)
        {
            AudioManager.instance.播放音效("test_sound");
        }
    }
    
    // 按L键开始循环播放音效
    if (Input.GetKeyDown(KeyCode.L))
    {
        if (AudioManager.instance != null)
        {
            AudioManager.instance.播放音效("test_loop", 1);
        }
    }
    
    // 按S键停止循环音效
    if (Input.GetKeyDown(KeyCode.S))
    {
        if (AudioManager.instance != null)
        {
            AudioManager.instance.播放音效("test_loop", 0);
        }
    }
}
```

## 调试模式

在AudioManager.cs中，日志会自动输出到Console：
- "开始播放BGM: xxx" - BGM成功播放
- "播放音效: xxx" - 音效成功播放
- "循环播放音效: xxx" - 循环音效成功播放
- "停止循环音效: xxx" - 循环音效成功停止
- "无法加载BGM: xxx" - BGM加载失败
- "无法加载音效: xxx" - 音效加载失败
- "无法加载循环音效: xxx" - 循环音效加载失败
- "找不到音频文件: xxx" - 找不到指定的音频文件

查看Console可以帮助您定位问题。

## 建议的测试音频文件

您可以从以下网站获取免费的测试音频：
- freesound.org
- zapsplat.com
- mixkit.co/free-sound-effects

建议下载：
1. 一个循环背景音乐（30秒-2分钟）→ 用于测试MUSIC
2. 几个短音效（0.5-2秒）→ 用于测试SOUND(一次性播放)
3. 一个环境音效（如雨声、风声）→ 用于测试SOUND(循环播放)

保存为WAV格式以获得最佳兼容性。

## 使用场景示例

### 场景1：环境氛围
- 进入森林：`SOUND(forest_ambient,1)` - 开始播放森林环境音（循环）
- 离开森林：`SOUND(forest_ambient,0)` - 森林环境音平滑结束（不会突然中断）

### 场景2：战斗场景
- 战斗开始：`MUSIC(battle_bgm)+SOUND(battle_ambient,1)` - 播放战斗音乐和环境音
- 战斗结束：`MUSIC(normal_bgm)+SOUND(battle_ambient,0)` - 切换回普通音乐，战斗环境音平滑结束

### 场景3：雨天场景
- 开始下雨：`SOUND(rain,1)` - 循环播放雨声
- 雨停：`SOUND(rain,0)` - 雨声渐渐停止（会播放完当前这一次，模拟雨渐停的效果）

### 场景4：门的音效
- 没有循环时：`SOUND(door,0)` - 播放一次门声
- 循环播放时：`SOUND(door,1)` 然后 `SOUND(door,0)` - 门声会平滑停止

